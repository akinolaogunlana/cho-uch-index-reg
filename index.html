<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CHO INDEXING FORM</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>CHO INDEXING DATA COLLECTION</h2>

<form id="indexForm">

  <!-- Personal Information -->
  <input name="surname" placeholder="SURNAME" required><br>
  <input name="firstname" placeholder="FIRSTNAME" required><br>
  <input name="othernames" placeholder="OTHERNAMES"><br>

  <label for="passport">PASSPORT</label><br>
  <input type="file" id="passport" accept="image/*" required><br>

  <input name="cadre" value="CHO" readonly><br>

  <select name="gender" required>
    <option value="">SELECT GENDER</option>
    <option value="MALE">MALE</option>
    <option value="FEMALE">FEMALE</option>
  </select><br>

  <input name="bloodgroup" placeholder="BLOOD GROUP"><br>
  <input name="state" placeholder="STATE"><br>
  <input name="lga" placeholder="LGA / CITY/TOWN"><br>
  <label for="dob">DATE OF BIRTH</label><br>
  <input type="date" name="dob" id="dob" required><br>

  <!-- O'LEVEL -->
  <select name="olevel_type" required>
    <option value="">SELECT O-LEVEL TYPE</option>
    <option value="WAEC">WAEC (Single Sitting)</option>
    <option value="NECO">NECO (Single Sitting)</option>
    <option value="WAEC / WAEC">WAEC / WAEC (Two Sittings)</option>
    <option value="NECO / NECO">NECO / NECO (Two Sittings)</option>
    <option value="NECO / WAEC">NECO / WAEC (Combined)</option>
  </select><br>
  <input name="olevel_year" placeholder="O-LEVEL YEAR(S)"><br>
  <input name="olevel_exam" placeholder="O-LEVEL EXAM NUMBER"><br>

  <!-- A'LEVEL / PROFESSIONAL -->
  <input name="alevel_type" placeholder="A-LEVEL TYPE"><br>
  <input name="alevel_year" placeholder="A-LEVEL YEAR"><br>
  <input name="pro_cert" placeholder="PROFESSIONAL CERTIFICATE NUMBER"><br>

  <!-- Subjects & Grades -->
  <input id="engGrade" placeholder="ENGLISH GRADE" required>
  <select id="engBody">
    <option value="WAEC">WAEC</option>
    <option value="NECO">NECO</option>
  </select><br>

  <input id="mathGrade" placeholder="MATHEMATICS GRADE" required>
  <select id="mathBody">
    <option value="WAEC">WAEC</option>
    <option value="NECO">NECO</option>
  </select><br>

  <input id="bioGrade" placeholder="BIOLOGY GRADE">
  <select id="bioBody">
    <option value="WAEC">WAEC</option>
    <option value="NECO">NECO</option>
  </select><br>

  <input id="chemGrade" placeholder="CHEMISTRY GRADE">
  <select id="chemBody">
    <option value="WAEC">WAEC</option>
    <option value="NECO">NECO</option>
  </select><br>

  <input id="phyGrade" placeholder="PHYSICS GRADE">
  <select id="phyBody">
    <option value="WAEC">WAEC</option>
    <option value="NECO">NECO</option>
  </select><br>

  <input name="remarks" placeholder="REMARKS"><br><br>

  <button type="submit">SUBMIT</button>
</form>

<script>
  // === REPLACE THESE WITH YOUR DETAILS ===
  const SHEETBEST_URL = "https://api.sheetbest.com/sheets/c610f771-67a2-4120-b4fa-c2d102aee546";
  const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/444391351669479/upload"; // Your Cloudinary Cloud Name
  const CLOUDINARY_PRESET = "zZVWX8x_CQogXAd0B7GIIcXaK_0"; // Your Upload Preset

  document.getElementById("indexForm").addEventListener("submit", async function(e) {
    e.preventDefault();
    const form = e.target;

    // 1️⃣ Upload passport
    const passportFile = document.getElementById("passport").files[0];
    if (!passportFile) return alert("Please select a passport image.");

    const cloudForm = new FormData();
    cloudForm.append("file", passportFile);
    cloudForm.append("upload_preset", CLOUDINARY_PRESET);

    let passportUrl = "";
    try {
      const cloudRes = await fetch(CLOUDINARY_URL, { method: "POST", body: cloudForm });
      const cloudData = await cloudRes.json();
      passportUrl = cloudData.secure_url;
    } catch(err) {
      console.error(err);
      return alert("Passport upload failed. Check Cloudinary settings.");
    }

    // 2️⃣ Combine grades
    const subjects = ["english","maths","biology","chemistry","physics"];
    const data = {};
    subjects.forEach(subj => {
      const grade = document.getElementById(subj.slice(0,3)+"Grade").value;
      const board = document.getElementById(subj.slice(0,3)+"Body").value;
      data[subj.toUpperCase()] = `${grade} (${board})`;
    });

    // 3️⃣ Collect form data
    data["SURNAME"] = form.surname.value.toUpperCase();
    data["FIRSTNAME"] = form.firstname.value.toUpperCase();
    data["OTHERNAMES"] = form.othernames.value.toUpperCase();
    data["PASSPORT"] = passportUrl;
    data["CADRE"] = form.cadre.value;
    data["GENDER"] = form.gender.value;
    data["BLOOD_GROUP"] = form.bloodgroup.value;
    data["STATE"] = form.state.value;
    data["LGA_CITY_TOWN"] = form.lga.value;
    data["DATE_OF_BIRTH"] = form.dob.value;
    data["OLEVEL_TYPE"] = form.olevel_type.value;
    data["OLEVEL_YEAR"] = form.olevel_year.value;
    data["OLEVEL_EXAM_NUMBER"] = form.olevel_exam.value;
    data["ALEVEL_TYPE"] = form.alevel_type.value;
    data["ALEVEL_YEAR"] = form.alevel_year.value;
    data["PROFESSIONAL_CERTIFICATE_NUMBER"] = form.pro_cert.value;
    data["REMARKS"] = form.remarks.value;

    // 4️⃣ Send to SheetBest
    try {
      const res = await fetch(SHEETBEST_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
      });
      const result = await res.json();
      alert("Submission successful!");
      form.reset();
    } catch(err) {
      console.error(err);
      alert("Submission failed. Check console for details.");
    }
  });
</script>

</body>
</html>